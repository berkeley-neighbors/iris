{% extends "base.html" %} {% block content %} {% if synology_sdk_url %}
<script src="{{ synology_sdk_url }}"></script>
<script>
  SYNOSSO.init({
    oauthserver_url: "{{ oauthserver_url }}",
    app_id: "{{ synology_app_id }}",
    redirect_uri: "{{ redirect_uri }}",
    scope: "user_id",
    callback: function (response) {
      if (response.status === "login") {
        window.location.href = "/auth-response?token=" + response.access_token;
      }

      if (response.status === "not_login") {
        alert("Synology SSO login failed");
      }
    },
  });
</script>
{% endif %}
<div class="main login floating-module">
  <div class="module">
    <div class="logo-wrapper">
      <img id="logo" src="/static/images/iris.png" height="70px" width="70px" />
      <p>Iris</p>
    </div>
    <form method="POST">
      {% if last_flash %}
      <div class="alert alert-{{ last_flash.type }}">
        {{ last_flash.message }}
      </div>
      {% endif %} {% if auth_type == 'ldap' %}
      <input
        class="form-control border-bottom"
        name="username"
        type="text"
        placeholder="Username"
        autofocus
      />
      <input
        class="form-control border-bottom"
        name="password"
        type="password"
        placeholder="Password"
      />
      <button class="form-control btn btn-primary">login</button>
      {% elif auth_type == 'synology' %}
      <button
        class="form-control btn btn-primary"
        type="button"
        id="synology-sso-login"
      >
        Sign in with Synology SSO
      </button>
      {% endif %}
    </form>
  </div>
</div>
<script>
  document
    .getElementById("synology-sso-login")
    .addEventListener("click", function () {
      SYNOSSO.login();
    });
</script>
{% endblock %}
